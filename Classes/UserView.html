<!doctype html><html lang='en'><head><title>UserView | SuperCollider 3.14.0-rc1 Help</title>
<link rel='stylesheet' href='./../static/scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../static/codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../static/editor.css' type='text/css' />
<link rel='stylesheet' id='scdoc-theme' href='./../static/themes/default.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<link rel='stylesheet' href='./../static/lib/katex/katex.min.css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../static/lib/jquery.min.js'></script>
<script src='./../static/lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../static/lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script defer src='./../static/lib/katex/katex.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'UserView';
var scdoc_sc_version = '3.14.0-rc1';
</script>
<script src='./../static/scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='./../frontend.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>UserView:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Inherited%20class%20methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Drawing'>Drawing</a></li>
<ul class='toc'><li class='toc3'><a href='#-drawFunc'>drawFunc</a> </li>
<li class='toc3'><a href='#-background'>background</a> </li>
<li class='toc3'><a href='#-drawingEnabled'>drawingEnabled</a> </li>
<li class='toc3'><a href='#-clearOnRefresh'>clearOnRefresh</a> </li>
<li class='toc3'><a href='#-clearDrawing'>clearDrawing</a> </li>
</ul><li class='toc2'><a href='#Animation'>Animation</a></li>
<ul class='toc'><li class='toc3'><a href='#-animate'>animate</a> </li>
<li class='toc3'><a href='#-frameRate'>frameRate</a> </li>
<li class='toc3'><a href='#-frame'>frame</a> </li>
</ul><li class='toc2'><a href='#Actions'>Actions</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Inherited%20instance%20methods'>Inherited instance methods</a></li>
</ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#Basic%20Usage'>Basic Usage</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Responding%20to%20mouse%20clicks%20and%20movement'>Responding to mouse clicks and movement</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Animation'>Animation</a></li>
<ul class='toc'></ul></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Classes</span>
 | <span id='categories'><a href='./../Browse.html#GUI'>GUI</a>&#8201;&gt;&#8201;<a href='./../Browse.html#GUI>Views'>Views</a></span>
</div><h1>UserView</h1>
<div id='summary'>A custom drawn view using Pen</div>
</div>
<div class='subheader'>
<div id='filename'>Location: <b>NOT INSTALLED!</b></div>
<div id='related'>See also: <a href="./../Classes/Pen.html">Pen</a></div>
</div>
<h2><a class='anchor' name='description'>Description</a></h2>

<p>An empty view on which you can draw using the <a href="./../Classes/Pen.html">Pen</a> class.
<p>This view displays and does nothing by itself, but allows you to define how it will be drawn, and expects you to define its entire mode of interaction using mouse, key, and drag and drop actions.
<p>To define how the view is drawn you set the <a href="#-drawFunc">-drawFunc</a> variable to a <a href="./../Classes/Function.html">Function</a> within which you can use the <a href="./../Classes/Pen.html">Pen</a> class to draw graphical primitives, such as lines, rectangles, ellipses, curves, and also text.
<p>This class offers convenient mechanisms for creating animations, that is, to automatically redraw itself in regular time intervals. See the <a href="#Animation">Animation</a> section of this document.
<p>For a guide to using this view, see <a href="./../Guides/GUI-Introduction.html#Custom%20views">Introduction to GUI: Custom views</a>.<div class='note'><span class='notelabel'>NOTE:</span> Older tutorials might recommend subclassing UserView. Don't do that. Use composition, not inheritance. Make the UserView a property of your custom view class.</div><h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3><a class='anchor' name='Inherited%20class%20methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='Drawing'>Drawing</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-drawFunc' href='./../Overviews/Methods.html#drawFunc'>drawFunc</a></h3>
<div class='method'>
<p> Sets the Function to evaluate whenever the view is asked to redraw itself. This may be, for example, due to being hidden and shown again, being resized, another view moving on top of it, or after the <a href="./../Classes/View.html#-refresh">View: -refresh</a> method has been called.
<p> Within that Function you are allowed to use the <a href="./../Classes/Pen.html">Pen</a> class to draw within the bounds of the view. All the coordinates given to the methods of Pen are relative to the top-left corner of the view. Usage of Pen is not allowed outside of that Function.
<p> The Function will be passed this view as the argument when evaluated.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'><td class='argumentdesc'>
<p> A Function.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-background' href='./../Overviews/Methods.html#background'>background</a></h3>
<div class='method'>
<p> Sets the color used to fill the whole area occupied by the view below the drawing done in <a href="#-drawFunc">-drawFunc</a>. You can set the background at any moment, even within the <code>drawFunc</code>, but any drawing done in that Function will always be displayed on top of the background.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'><td class='argumentdesc'>
<p> A Color.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-drawingEnabled' href='./../Overviews/Methods.html#drawingEnabled'>drawingEnabled</a></h3>
<div class='method'>
<p> Whether the <a href="#-drawFunc">-drawFunc</a> will be called when the view is redrawing itself. Note that <a href="#-background">-background</a> will be painted regardless of this variable.
<p> The default value is <code>true</code>.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'><td class='argumentdesc'>
<p> A Boolean.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-clearOnRefresh' href='./../Overviews/Methods.html#clearOnRefresh'>clearOnRefresh</a></h3>
<div class='method'>
<p> Whether the view shall clear the last drawing done in <a href="#-drawFunc">-drawFunc</a> before being redrawn.
<p> If this is <code>false</code>, the view will continuously draw on top of all the previous drawing whenever it is redrawn, until <a href="#-clearDrawing">-clearDrawing</a> is called.
<p> The default value is <code>true</code>.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'><td class='argumentdesc'>
<p> A Boolean.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-clearDrawing' href='./../Overviews/Methods.html#clearDrawing'>clearDrawing</a></h3>
<div class='method'>
<p> If <a href="#-clearOnRefresh">-clearOnRefresh</a> is <code>false</code>, you can call this method to manually clear any drawing done in <a href="#-drawFunc">-drawFunc</a> so far.</div><h3><a class='anchor' name='Animation'>Animation</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-animate' href='./../Overviews/Methods.html#animate'>animate</a></h3>
<div class='method'>
<p> Whether the view shall redraw itself internally at a regular time interval (frame rate). See <a href="#-frameRate">-frameRate</a> for the way to adjust that interval.
<p> The default value is <code>false</code>.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'><td class='argumentdesc'>
<p> A Boolean.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-frameRate' href='./../Overviews/Methods.html#frameRate'>frameRate</a></h3>
<div class='method'>
<p> The interval at which the view regularly redraws itself, if <a href="#-animate">-animate</a> is <code>true</code>. You can change the desired frame rate by setting this variable.
<p> The default frame rate is 60fps.<div class='note'><span class='notelabel'>NOTE:</span> Getting the value of this variable will return the average actual frame rate. If it is lower than the desired frame rate set as described above, that implies that the view tries but does not manage to redraw itself at that frame rate. The reason may typically be that the drawing defined in <a href="#-drawFunc">-drawFunc</a> is computationally too demanding for the system.</div><h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>fps<td class='argumentdesc'>
<p> A Float defining the interval between frames of animation, in frames per second.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-frame' href='./../Overviews/Methods.html#frame'>frame</a></h3>
<div class='method'>
<p> The count of frames drawn while <a href="#-animate">-animate</a> is <code>true</code>; it will increase by 1 every time the view is redrawn.
<p> If animation is stopped and started again (by setting <code>animate</code> to <code>false</code> and then <code>true</code> again), the frame count is restarted.<h4>Returns:</h4>
<div class='returnvalue'>
<p>An Integer.</div></div><h3><a class='anchor' name='Actions'>Actions</a></h3>

<p> The UserView by itself does not respond to any interaction by the user. You can define the modes of interaction entirely on your own using mouse and keyboard actions. See <a href="./../Guides/GUI-Introduction.html#Actions%20and%20hooks:%20Make%20that%20button%20do%20something!">Actions and Hooks</a> for detailed explanation.
<p> Note that there is no default mode of interaction with the UserView, so <a href="./../Classes/View.html#-action">View: -action</a> will never be triggered, if you don't implement that yourself.<h3><a class='anchor' name='Inherited%20instance%20methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h2><a class='anchor' name='examples'>Examples</a></h2>

<p>'Introduction to GUI' contains an <a href="./../Guides/GUI-Introduction.html#Custom%20views">example</a> with elaborate explanation on how to use UserView. Below are further examples.<h3><a class='anchor' name='Basic%20Usage'>Basic Usage</a></h3>

<p>Resize the window or click on the UserView to refresh the drawing:<div class='codeMirrorContainer'><textarea class='editor'>(
w = Window.new;
v = UserView(w, w.view.bounds.insetBy(50, 50));
v.resize = 5;
v.background_(Color.rand);
v.drawFunc = { |uview|
        Pen.moveTo(0@uview.bounds.height.rand);
        Pen.lineTo(uview.bounds.width@uview.bounds.height.rand);
        Pen.stroke;
    };
v.mouseDownAction = { v.refresh };
w.front;
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p>Coordinates are relative to the UserView. Try resizing the window:<div class='codeMirrorContainer'><textarea class='editor'>(
var func;

func = { |me|
    Pen.use{
        10.do{
            Color.red(rrand(0.0, 1), rrand(0.0, 0.5)).set;
            Pen.addArc((400.exprand(2))@(100.rand), rrand(10, 100), 2pi.rand, pi);
            Pen.perform([\stroke, \fill].choose);
        }
    }
};

w = Window.new("DrawFunc Examples").front;
w.view.background_(Color.white);

3.do{ |i|
    v = UserView(w, Rect(20+(i*120), 100, 100, 100))
        .drawFunc_(func);
    v.resize = 3; // the func coordinates ar valid even though the view move on resize
    v.background_(Color.rand);
};

w.refresh;
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>
<h3><a class='anchor' name='Responding%20to%20mouse%20clicks%20and%20movement'>Responding to mouse clicks and movement</a></h3>

<p>Using <a href="./../Classes/View.html#Mouse%20actions">mouse actions</a> you can make UserView change the way it is drawn in response to mouse interaction. The sequence of examples below will guide you through the various possibilities.
<p>Clicking and moving the mouse on each of the painted squares in the following example will redraw them differently. See interpreter output for posted information that you can use in the mouse actions.<div class='codeMirrorContainer'><textarea class='editor'>// drag some circles
(
var w, r, u;
var clicked, relativeWhere;
r = { Rect(300.rand, 300.rand, 110, 110) } ! 4;

w = Window.new.front;
u = UserView(w, Rect(0, 0, 400, 400));
u.drawFunc = {
    r.do { |x, i|
        Pen.addOval(x); // wie addRect
        Pen.color = Color.hsv(0.9 * (1/(i+1)), 0.6, 1);
        Pen.draw;
    };
};
u.mouseDownAction = { |v, x, y|
    r.do { |rect, i|
        if(rect.contains(Point(x, y))) {
            clicked = i;
            relativeWhere = Point(x, y) - rect.origin;
        };
    };
};

u.mouseMoveAction = { |v, x, y|
    var rect;
    if(clicked.notNil) {
        rect = r.at(clicked);
        r.put(clicked, rect.origin = Point(x, y) - relativeWhere);
        w.refresh;
    }
};

u.mouseUpAction = {
    clicked = nil;
}
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>
<div class='codeMirrorContainer'><textarea class='editor'>// draw some random shapes
(
var drawFunc, mouseDownFunc, mouseUpFunc, mouseMoveFunc, sat = 0, startX;

drawFunc = { |me|
    Pen.use{
        10.do{
            Color.red(rrand(0.0, 1), rrand(0.3, 0.8)).set;
            Pen.addArc((400.exprand(2))@(100.rand), rrand(10, 50), 2pi.rand, pi);
            Pen.perform([\stroke, \fill].choose);
        }
    }
};

mouseDownFunc = { |me, x, y, mod|
    startX = x;
    postf("begin path: x=% realtive mouse coordinates:%\n", startX, x@y);
};

mouseUpFunc = { |me, x, y, mod|
    postf("end path: (startX-x)==% mouse coordinates:%\n", (startX-x), x@y);
};

mouseMoveFunc = { |me, x, y, mod|
    sat = ((startX-x)/100);
    (x@y).postln;
    me.refresh;
};

w = Window.new.front;
w.view.background_(Color.white);
3.do{ |i|
    v = UserView(w, Rect(20+(i*120), 100, 100, 100));
    v.background_(Color.rand);
    v.drawFunc = drawFunc;
    v.mouseDownAction = mouseDownFunc;
    v.mouseUpAction = mouseUpFunc;
    v.mouseMoveAction = mouseMoveFunc;
};
w.refresh;
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p>The following example uses the <a href="#-clearOnRefresh">-clearOnRefresh</a> option to prevent the UserView from clearing its contents when redrawn. Clicking and moving the mouse within each square will draw ever more arcs on top of each other.<div class='codeMirrorContainer'><textarea class='editor'>(
var func, views;

func = { |me|
    Pen.use{
        1.do{
            Color(
                rrand(0.0, 1),
                rrand(0.0, 0.2),
                rrand(0.0, 0.8),
                rrand(0.4, 0.8)
            ).set;
            Pen.addArc((400.exprand(2))@(100.rand), rrand(10, 50), 2pi.rand, pi);
            Pen.perform([\stroke, \fill].choose);
        }
    }
};

w = Window.new("DrawFunc Examples").front;
w.view.background_(Color.white);
views = { |i|
    v = UserView(w, Rect(20+(i*120), 100, 100, 100));
    v.background = Color.rand;
    v.drawFunc = func;
    v.mouseMoveAction = { |me| me.refresh };
    v.clearOnRefresh_(false);
} ! 3;
w.refresh;
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p>The following example uses the <a href="#-clearOnRefresh">-clearOnRefresh</a> option to keep the old contents when redrawn, allowing you to draw a line which follows the mouse cursor by clicking and dragging on the view.
<p>It also uses the mouse position to compute the color of the line.<div class='codeMirrorContainer'><textarea class='editor'>(
var w, txt, lines, points, drawLine;

drawLine = { |points, bounds|
    var p0;
    points.do { |p, i|
        if(i == 0){
            p0 = p;
        }{
            Pen.moveTo(p0);
            Pen.lineTo(p);
            Color(
                (p.x/bounds.width).clip(0, 1),
                1.0-(p.x/bounds.width).clip(0, 1),
                (p.y/bounds.height).clip(0, 1)
            ).set;
            Pen.stroke;
            p0 = p;
        }
    };
};

w = Window("draw on me", Rect(128, 64, 340, 360));

v = UserView(w, w.view.bounds)
    .clearOnRefresh_(false)
    .mouseDownAction_({ |v, x, y|
        points = [x@y];
    })
    .mouseMoveAction_({ |v, x, y|
        points = points.add(x@y);
        v.refresh;
    })
    .mouseUpAction_({ |v, x, y|
        points = points.add(x@y);
        lines = lines.add(points);
        points = nil;
        v.refresh;
    })
    .background_(Color.white)
    .drawFunc_{ |me|
        var r = me.bounds;

        Pen.use {
            Pen.width = 1;
            Color.black.set;

            lines.do { |linePoints|
                drawLine.value(linePoints, r);
            };
            lines = nil;

            drawLine.value(points, r);
            if(points.size &gt; 0) { points = [points.last] };
        };
    };

w.front;
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>
<h3><a class='anchor' name='Animation'>Animation</a></h3>

<p>The following is an animation with mouse interaction. Click and drag in the view to move the center of the rotating object.<div class='codeMirrorContainer'><textarea class='editor'>(
var width = 400, height = 400, mx = 0, my = 0, pt, r;

w = Window("animation and mouse interaction", Rect(100, 200, width, height), false);

u = UserView(w, Rect(0, 0, width, height));
u.background = Color.black;
u.animate = true; // animate this view

// allocate data in advance, for optimization:
pt = Point();
r = Rect();

u.drawFunc = {
    Pen.fillColor = Color.green;
    Pen.stringAtPoint(u.frameRate.asString, Point(10, 10)); // display frame rate
    Pen.stringAtPoint(u.frame.asString, Point(10, 30)); // display frame counter
    Pen.color = Color.white;
    pt.x = mx;
    pt.y = my;
    100.do{ |i|
        Pen.moveTo(pt);
        pt.x = sin(u.frame*0.04.neg+i)*(5*i)+mx; // use .frame to drive animation
        pt.y = cos(u.frame*0.05+i)*(5*i)+my;
        r.left = pt.x;
        r.top = pt.y;
        r.width = i;
        r.height = i;
        Pen.lineTo(pt);
        Pen.fillStroke;
        Pen.addOval(r);
        Pen.fillStroke;
    };
};
u.mouseDownAction = { |v, x, y|
    mx = x;
    my = y;
};
u.mouseMoveAction = u.mouseDownAction;
w.front;
)

u.animate = false; // animation can be paused and resumed
u.animate = true;
w.close; // stops animation</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p>A simple ball animation:<div class='codeMirrorContainer'><textarea class='editor'>(
var width = 400, height = 400, xspeed = 3, yspeed = 2, x = width*0.5, y = height*0.5;
w = Window("ball", Rect(100, 200, width, height));
u = UserView(w, Rect(0, 0, width, height));
u.background = Color.black;
u.animate = true;
u.drawFunc = {
    if(x&lt;0 or: { x&gt;width }, { xspeed = 0-xspeed });
    if(y&lt;0 or: { y&gt;height }, { yspeed = 0-yspeed });
    x = x+xspeed;
    y = y+yspeed;
    Pen.fillColor = Color.white;
    Pen.fillOval(Rect.aboutPoint(Point(x, y), 8, 8));
};
w.front;
)

( // replace the drawFunc above while running
u.drawFunc = {
    Pen.fillColor = Color.red;
    Pen.fillOval(Rect(200, 200, sin(u.frame*0.031)*200, sin(u.frame*0.044)*200));
    Pen.fillOval(Rect(200, 200, sin(u.frame*0.052)*200, sin(u.frame*0.065)*200));
    Pen.fillOval(Rect(200, 200, sin(u.frame*0.073)*200, sin(u.frame*0.086)*200));
}
)

// close the window to stop
w.close;</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p>An animation that makes a good use of the <a href="#-clearOnRefresh">-clearOnRefresh</a> option to keep the old contents when redrawing.<div class='codeMirrorContainer'><textarea class='editor'>(
var width = 640, height = 480, w, theta = 0, drawFunc;
w = Window("trails", Rect(128, 64, width, height), false);
drawFunc = { |view|
    var x = 20 * sin(theta), y = 42 * cos(theta);
    theta = theta + 0.01;
    // draw a semitransparent rect filling the screen:
    Pen.fillColor_(Color.red(0.2, 0.1));
    Pen.fillRect(Rect(0, 0, width, height));
    Pen.strokeColor_(Color.white);
    Pen.translate(width * 0.5, height * 0.5);
    6.do { |i|
        Pen.rotate(theta * (1 - (i / 6)));
        Pen.scale(0.7 + (i * 0.4), 0.4 + (i * 0.5));
        Pen.strokeOval(Rect.aboutPoint(Point(x, y), 60, 40));
    };
};
x = UserView(w, Rect(10, 10, width - 20, height - 20))
    .canFocus_(false)
    .drawFunc_(drawFunc)
    .clearOnRefresh_(false);

w.front;
x.animate = true
)</textarea>
<button class='copy-button' aria-label='Copy code'><span class='copy-ico'>⧉</span><span class='check-ico'>✔</span></button></div>

<p><div class='doclink'>helpfile source: <a href='https://github.com/supercollider/supercollider/tree/3.14/HelpSource/Classes/UserView.schelp'>https://github.com/supercollider/supercollider/tree/3.14/HelpSource/Classes/UserView.schelp</a><br>link::Classes/UserView::<br></div></div><script src='./../static/editor.js' type='text/javascript'></script>
</body></html>